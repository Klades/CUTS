<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<project name="test.build" basedir="." default="test.run.all">
  <!-- import the environment -->
  <property environment="env" />

  <!-- set the default properties -->
  <property name="test.basedir" value="${env.CUTS_ROOT}/tests" />
  <property name="test.logdir" value="${test.basedir}/logs" />
  <property name="test.bindir" value="${test.basedir}/bin" />

  <!--
      run all the unit test in CUTS
      -->

  <target name="test.run.all">
    <antcall target="test.run.CUTS" />
  </target>

  <!--
      run all the unit test for the CUTS library
      -->

  <target name="test.run.CUTS">
    <antcall target="test.run">
      <param name="test.executable" value="CUTS_Port_Measurement_Test" />
    </antcall>

    <antcall target="test.run">
      <param name="test.executable" value="CUTS_Time_Measurement_Test" />
    </antcall>

    <antcall target="test.run">
      <param name="test.executable" value="CUTS_Timestamp_Metric_Test" />
    </antcall>

    <antcall target="test.run">
      <param name="test.executable" value="CUTS_Statistics_T_Test" />
    </antcall>
  </target>

  <!--
      Helper target to execute the unit test.
      -->

  <target name="test.run">
    <exec executable="${test.bindir}/${test.executable}"
          dir="${test.bindir}"
          output="${test.logdir}/${test.executable}.log"
          append="false">
      <arg value="--log_level=test_suite" />
      <arg value="--detect_memory_leaks=0" />
      <arg value="--result_code=no" />
      <arg value="--build_info=yes" />
      <arg value="--report_level=no" />
    </exec>
  </target>

  <target name="test.logs.clean">
    <delete>
      <fileset dir="${test.logdir}" includes="*.log" />
    </delete>
  </target>
</project>
