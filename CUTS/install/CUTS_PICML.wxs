<?xml version='1.0' encoding='utf-8' standalone='yes' ?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
  <Fragment Id='CUTS_CoSMIC'>
    <DirectoryRef Id='schemas'>
      <Component Id='CUTS_PICML_schemas' Guid='F550B32C-9221-4d32-B328-ACB4182E17BA'>
        <File Id='modelgen.xsd' Name='modelgen.xsd'
              Source='$(env.CUTS_ROOT)\etc\schemas\modelgen.xsd' />
      </Component>

    </DirectoryRef>
    
    <DirectoryRef Id='bin'>
      <Component Id='CUTS_PICML' Guid='1B880B88-2944-419C-843F-433096213675'>
        <!-- install the XML configuration -->
        <File Id="cuts.config" Name="cuts.config"
              Source="$(env.CUTS_ROOT)\bin\cuts.user.config" DiskId="1" />

        <File Id="CUTS_BE.dll" Name="CUTS_BE.dll"
              Source="$(env.CUTS_ROOT)\lib\CUTS_BE.dll" DiskId="1" />

        <File Id="CUTS_PICML.dll" Name="CUTS_PICML.dll"
              Source="$(env.CUTS_ROOT)\lib\CUTS_PICML.dll" DiskId="1" />

        <File Id="XERCES_C_2_6.DLL" Name="XERCES-C_2_7.DLL"
              Source="$(env.XERCESCROOT)\bin\xerces-c_2_7.dll" DiskId="1" />

        <File Id="XSCRT_Utils.dll" Name="XSCRT.dll"
              Source="$(env.XSC_ROOT)\lib\XSCRT.dll" DiskId="1" />

        <File Id="ACE.dll" Name="ACE.dll"
              Source="$(env.ACE_ROOT)\lib\ACE.dll" DiskId="1" />

        <File Id="GME.dll" Name="GME.dll"
              Source="$(env.COSMIC_ROOT)\bin\GME.dll" DiskId="1" />

        <File Id="PICML.dll" Name="PICML.dll"
              Source="$(env.COSMIC_ROOT)\bin\PICML.dll" DiskId="1" />

        <File Id="Utils.dll" Name="Utils.dll"
              Source="$(env.COSMIC_ROOT)\bin\Utils.dll" DiskId="1" />

        <!-- install the CIAO generator -->
        <File Id="CUTS_BE_CIAO.dll" Name="CUTS_BE_CIAO.dll"
              Source="$(env.CUTS_ROOT)\lib\CUTS_BE_CIAO.dll" DiskId="1" />

        <util:XmlConfig Id="generator.CIAO"
                        File="[INSTALLDIR]bin\cuts.config" 
                        Action="create"
                        ElementPath="//cuts:modelgen/backend"
                        VerifyPath="//cuts:modelgen/backend/cuts:generator[\[]@id='CIAO'[\]]"
                        Name="cuts:generator" 
                        Node="element"
                        Sequence="1" 
                        On="install" />

        <util:XmlConfig Id="generator.CIAO.delete"
                        File="[INSTALLDIR]bin\cuts.config" 
                        Action="delete"
                        ElementPath="//cuts:modelgen/backend/cuts:generator[\[]@id='CIAO'[\]]"
                        Node="element"
                        Sequence="1" 
                        On="uninstall" />

        <util:XmlConfig Id="generator.CIAO.id" 
                        File="[INSTALLDIR]bin\cuts.config" 
                        ElementPath="generator.CIAO"                       
                        Name="id"
                        Value="CIAO"
                        Sequence="2" />

        <util:XmlConfig Id="generator.CIAO.location" 
                        File="[INSTALLDIR]bin\cuts.config" 
                        Action="create"
                        ElementPath="//cuts:modelgen/backend/cuts:generator[\[]@id='CIAO'[\]]"
                        Name="cuts:location" 
                        Node="element"
                        Sequence="3" 
                        On="install"
                        Value="[INSTALLDIR]bin\CUTS_BE_CIAO" />
<?ifdef release ?>
        <!-- install the XML generator -->
        <File Id="CUTS_BE_XML.dll" Name="CUTS_BE_XML.dll"
              Source="$(env.CUTS_ROOT)\lib\CUTS_BE_XML.dll" DiskId="1" />

        <util:XmlConfig Id="generator.XML"
                        File="[INSTALLDIR]bin\cuts.config" 
                        Action="create"
                        ElementPath="//cuts:modelgen/backend"
                        VerifyPath="//cuts:modelgen/backend/cuts:generator[\[]@id='XML'[\]]"
                        Name="cuts:generator" 
                        Node="element"
                        Sequence="1" 
                        On="install" />

        <util:XmlConfig Id="generator.XML.delete"
                        File="[INSTALLDIR]bin\cuts.config" 
                        Action="delete"
                        ElementPath="//cuts:modelgen/backend/cuts:generator[\[]@id='XML'[\]]"
                        Node="element"
                        Sequence="1" 
                        On="uninstall" />

        <util:XmlConfig Id="generator.XML.id" 
                        File="[INSTALLDIR]bin\cuts.config" 
                        ElementPath="generator.XML"                       
                        Name="id"
                        Value="XML"
                        Sequence="2" />

        <util:XmlConfig Id="generator.XML.location" 
                        File="[INSTALLDIR]bin\cuts.config" 
                        Action="create"
                        ElementPath="//cuts:modelgen/backend/cuts:generator[\[]@id='XML'[\]]"
                        Name="cuts:location" 
                        Node="element"
                        Sequence="3" 
                        On="install"
                        Value="[INSTALLDIR]bin\CUTS_BE_XML" />
                        
        <!-- install the CAPI generator -->
        <File Id="CUTS_BE_CAPI.dll" Name="CUTS_BE_CAPI.dll"
              Source="$(env.CUTS_ROOT)\lib\CUTS_BE_CAPI.dll" DiskId="1" />

        <util:XmlConfig Id="generator.CAPI"
                        File="[INSTALLDIR]bin\cuts.config" 
                        Action="create"
                        ElementPath="//cuts:modelgen/backend"
                        VerifyPath="//cuts:modelgen/backend/cuts:generator[\[]@id='CAPI'[\]]"
                        Name="cuts:generator" 
                        Node="element"
                        Sequence="1" 
                        On="install" />

        <util:XmlConfig Id="generator.CAPI.delete"
                        File="[INSTALLDIR]bin\cuts.config" 
                        Action="delete"
                        ElementPath="//cuts:modelgen/backend/cuts:generator[\[]@id='CAPI'[\]]"
                        Node="element"
                        Sequence="1" 
                        On="uninstall" />

        <util:XmlConfig Id="generator.CAPI.id" 
                        File="[INSTALLDIR]bin\cuts.config" 
                        ElementPath="generator.CAPI"                       
                        Name="id"
                        Value="CAPI"
                        Sequence="2" />

        <util:XmlConfig Id="generator.CAPI.location" 
                        File="[INSTALLDIR]bin\cuts.config" 
                        Action="create"
                        ElementPath="//cuts:modelgen/backend/cuts:generator[\[]@id='CAPI'[\]]"
                        Name="cuts:location" 
                        Node="element"
                        Sequence="3" 
                        On="install"
                        Value="[INSTALLDIR]bin\CUTS_BE_CAPI" />
                        
        <!-- install the english generator -->
        <File Id="CUTS_BE_Natural_Lang.dll" Name="CUTS_BE_Natural_Lang.dll"
              Source="$(env.CUTS_ROOT)\lib\CUTS_BE_Natural_Lang.dll" DiskId="1" />

        <util:XmlConfig Id="generator.language.english"
                        File="[INSTALLDIR]bin\cuts.config" 
                        Action="create"
                        ElementPath="//cuts:modelgen/backend"
                        VerifyPath="//cuts:modelgen/backend/cuts:generator[\[]@id='language.english'[\]]"
                        Name="cuts:generator" 
                        Node="element"
                        Sequence="1" 
                        On="install" />

        <util:XmlConfig Id="generator.language.english.delete"
                        File="[INSTALLDIR]bin\cuts.config" 
                        ElementPath="//cuts:modelgen/backend/cuts:generator[\[]@id='language.english'[\]]"
                        Node="element"
                        Action="delete"
                        Sequence="1" 
                        On="uninstall" />

        <util:XmlConfig Id="generator.language.english.id" 
                        File="[INSTALLDIR]bin\cuts.config" 
                        ElementPath="generator.language.english"                       
                        Name="id"
                        Value="language.english"
                        Sequence="2" />

        <util:XmlConfig Id="generator.language.english.location" 
                        File="[INSTALLDIR]bin\cuts.config" 
                        Action="create"
                        ElementPath="//cuts:modelgen/backend/cuts:generator[\[]@id='language.english'[\]]"
                        Name="cuts:location" 
                        Node="element"
                        Sequence="3" 
                        On="install"
                        Value="[INSTALLDIR]bin\CUTS_BE_Natural_Lang" />

        <!-- install the TIOA generator -->
        <File Id="CUTS_BE_TIOA.dll" Name="CUTS_BE_TIOA.dll"
              Source="$(env.CUTS_ROOT)\lib\CUTS_BE_TIOA.dll" DiskId="1" />

        <util:XmlConfig Id="generator.TIOA"
                        File="[INSTALLDIR]bin\cuts.config" 
                        Action="create"
                        ElementPath="//cuts:modelgen/backend"
                        VerifyPath="//cuts:modelgen/backend/cuts:generator[\[]@id='TIOA'[\]]"
                        Name="cuts:generator" 
                        Node="element"
                        Sequence="1" 
                        On="install" />

        <util:XmlConfig Id="generator.TIOA.delete"
                        File="[INSTALLDIR]bin\cuts.config" 
                        ElementPath="//cuts:modelgen/backend/cuts:generator[\[]@id='TIOA'[\]]"
                        Node="element"
                        Action="delete"
                        Sequence="1" 
                        On="uninstall" />

        <util:XmlConfig Id="generator.TIOA.id" 
                        File="[INSTALLDIR]bin\cuts.config" 
                        ElementPath="generator.TIOA"                       
                        Name="id"
                        Value="TIOA"
                        Sequence="2" />

        <util:XmlConfig Id="generator.TIOA.location" 
                        File="[INSTALLDIR]bin\cuts.config" 
                        Action="create"
                        ElementPath="//cuts:modelgen/backend/cuts:generator[\[]@id='TIOA'[\]]"
                        Name="cuts:location" 
                        Node="element"
                        Sequence="3" 
                        On="install"
                        Value="[INSTALLDIR]bin\CUTS_BE_TIOA" />
<?endif?>

        <!-- GME registry information -->
        <RegistryKey Root="HKLM" Key="SOFTWARE">
          <RegistryKey Key="GME\Components">
            <RegistryKey Key="CUTS.Interpreter.PICML"
                         Action="createAndRemoveOnUninstall">
              <RegistryValue Name="Description" Type="string"
                             Value="CUTS Interpreter" Action="write" />
              <RegistryValue Name="Icon" Type="string"
                             Value=",IDI_COMPICON" Action="write" />
              <RegistryValue Name="Paradigm" Type="string"
                             Value="PICML" Action="write" />
              <RegistryValue Name="Tooltip" Type="string"
                             Value="CUTS interpreter" Action="write" />
              <RegistryValue Name="Type" Type="integer"
                            Value="1" Action="write" />
              <RegistryKey Key="Associated" Action="create">
                <RegistryValue Name="PICML" Type="string"
                               Action="write" Value="" />
              </RegistryKey>
            </RegistryKey>
          </RegistryKey>

          <RegistryKey Key="Classes">
            <!-- ProgID registry information -->
            <RegistryKey Key="CUTS.Interpreter.PICML"
                         Action="createAndRemoveOnUninstall">
              <RegistryValue Type="string" Value="CUTS.Interpreter.PICML" />
              <RegistryKey Key="CLSID" Action="create">
                <RegistryValue Type="string"
                               Value="{DD5752C3-12EF-43D0-978C-F5C395D5BF13}" />
              </RegistryKey>
            </RegistryKey>  
            
            <!-- CLSID registry information -->
            <RegistryKey Key="CLSID">
              <RegistryKey Key="{DD5752C3-12EF-43D0-978C-F5C395D5BF13}"
                          Action="createAndRemoveOnUninstall">
                <RegistryValue Type="string"
                              Value="CUTS.Interpreter.PICML" />
                <RegistryKey Key="InProcServer32" Action="create">
                  <RegistryValue Type="string"
                                Value="[INSTALLDIR]bin\CUTS_PICML.dll" />
                </RegistryKey>

                <RegistryKey Key="ProgID" Action="create">
                  <RegistryValue Type="string" Value="CUTS.Interpreter.PICML" />
                </RegistryKey>
              </RegistryKey>
            </RegistryKey>
          </RegistryKey>
        </RegistryKey>
      </Component>
    </DirectoryRef>

  </Fragment>
</Wix>
