// This file was generated by:
// $Id$

#include "Hello_ReceiverImpl.h"
#include "cuts/arch/ccm/CCM_Events_T.h"

namespace Hello_ReceiverImpl
{
  //
  // Receiver
  //
  Receiver::Receiver (void)
  {
    this->click_in_event_handler_.init (this, &Receiver::push_click_in_i);
    this->register_object (&this->click_in_event_handler_);
    this->push_message_event_handler_.init (this, &Receiver::push_push_message_i);
    this->register_object (&this->push_message_event_handler_);
  }

  //
  // ~Receiver
  //
  Receiver::~Receiver (void)
  {
  }

  //
  // sink: click_in
  //
  void Receiver::push_click_in (::Hello::TimeOut * ev)
  {
    this->click_in_event_handler_.handle_event (ev);
  }

  //
  // sink: click_in
  //
  void Receiver::push_click_in_i (::Hello::TimeOut * ev)
  {
    iterations(10);
    this->logger_.log (LM_DEBUG, "Start %s iteration %d at %Q", ev->data(), iterations(), ACE_OS::gettimeofday ().get_msec ());
    ::Hello::ReadMessage_var __event_100000010__ = this->ctx_->new_read_message_event ();
    __event_100000010__->data (ev->data());
    this->ctx_->push_read_message (__event_100000010__.in ());

    ACE_UNUSED_ARG (ev);
  }

  //
  // sink: push_message
  //
  void Receiver::push_push_message (::Hello::PushMessage * ev)
  {
    this->push_message_event_handler_.handle_event (ev);
  }

  //
  // sink: push_message
  //
  void Receiver::push_push_message_i (::Hello::PushMessage * ev)
  {
    this->logger_.log (LM_DEBUG, "Received %s iteration %d at %Q", ev->data(), iterations(), ACE_OS::gettimeofday ().get_msec ());
    if (iterations() > 0)
    {
      ::Hello::ReadMessage_var __event_100000018__ = this->ctx_->new_read_message_event ();
      __event_100000018__->data (ev->data());
      this->ctx_->push_read_message (__event_100000018__.in ());

      this->iterations_--;
    }

    else
    {
      this->logger_.log (LM_DEBUG, "Last %s iteration %d at %Q", ev->data(), iterations(), ACE_OS::gettimeofday ().get_msec ());
    }

    ACE_UNUSED_ARG (ev);
  }

  //
  // attribute setter: iterations
  //
  void Receiver::iterations (::CORBA::Short iterations)
  {
    this->iterations_ = iterations;
  }

  //
  // attribute getter: iterations
  //
  ::CORBA::Short Receiver::iterations (void)
  {
    return this->iterations_;
  }

  //
  // ccm_activate
  //
  void Receiver::ccm_activate (void)
  {
    this->logger_.connect ("corbaloc:iiop:localhost:50000/LoggingClient");
    this->base_type::ccm_activate ();
  }

  //
  // ccm_passivate
  //
  void Receiver::ccm_passivate (void)
  {
    this->base_type::ccm_passivate ();
    this->logger_.disconnect ();
  }
}

//
// create_Hello_Receiver_Impl
//
::Components::EnterpriseComponent_ptr
create_Hello_Receiver_Impl (void)
{
  ::Components::EnterpriseComponent_ptr retval =
    ::Components::EnterpriseComponent::_nil ();

  ACE_NEW_RETURN (retval,
                  ::Hello_ReceiverImpl::Receiver (),
                  ::Components::EnterpriseComponent::_nil ());

  return retval;
}


// end of auto-generated file

