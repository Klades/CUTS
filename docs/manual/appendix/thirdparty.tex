% $Id$

\chapter{Building and Installing Third-Party Libraries}
\label{chap:thirdparty}

The following appendix contains best practices for building
and installing third-party libraries used by CUTS projects. It is not
a requirement to install third-party libraries per the instructions in
this appendix. If you are experiencing compilation problems with CUTS
due to third-party libraries, however, the instructions in this appendix
may be of assistance. To make help explain the installation process
of the thirdparty libraries, it will be assumed that all third-party
libraries will be installed at the following location:
\texttt{/opt/thirdparty}\footnote{This location is representative 
of a common location for installing third-party libraries, and may
be different on your system.} \footnote{If you are installing CUTS
from source on Windows, it is recommended that you place all environment
variables in a BATCH file (\texttt{.bat}) so you do not pollute the
system environment.}.

\section{The Makefile, Project, Workspace Creator (MPC)}
\label{sec:thirdparty-mpc}

The \textit{Makefile, Project, Workspace Creator (MPC)} is a 
command-line utility for generating workspaces. It is required
to build different third-party libraries. and CUTS. The artifacts
for MPC can be downloaded from the following location: 
\url{https://svn.dre.vanderbilt.edu/DOC/MPC/trunk}. 

\subsection{System Configuration}

MPC does not need to be built since its a PERL application. Instead,
we must properly set environment variables to use MPC correctly. Please
therefore define the following environment variables:
\begin{lstlisting}
export MPC_ROOT=location of MPC
export PATH=$PATH:MPC_ROOT
\end{lstlisting}

\subsection{Installation}

There are no separate installation procedures for MPC.

\section{Boost}
\label{sec:thirdparty-boost}

The Boost libraries are required when building and installing CUTS. All
artifacts for Boost, such as prebuilt versions and source files, can be 
downloaded from the following location: \url{http://www.boost.org}. Currently XSC seems to only work with Boost 1.43.0.

\subsection{System Configuration}

To build CUTS correctly, the Boost environment variables must be defined. Please 
define the following required environment variables:
\begin{lstlisting}
%> export BOOST_ROOT=/opt/thirdparty/boost
%> export BOOST_VERSION=boost-1_34_1
%> export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$BOOST_ROOT/lib
%> export PATH=$PATH:$BOOST_ROOT/bin
\end{lstlisting}
In some cases, Boost libraries will have an optional configuration appended to 
their filename, such as \texttt{-mt-d}. To use a specific configuration of 
Boost, the \texttt{BOOST\_CFG} environment variable must be defined. The 
following is an example of defining the Boost configuration environment 
variable:
\begin{lstlisting}
%> export BOOST_CFG=-mt-d
\end{lstlisting}
The configuration of Boost is now complete. 

\subsection{Installation}

\subsubsection{Non-Windows}
 
If you are installing Boost on a non-Windows system, \textit{e.g.}, Linux, 
Soloris, or MacOS X, then you can download the source code directly from its
main website (\url{http://www.boost.org}), build it, and install it using
standard procedures.

As a quick reference, you can quickly build Boost using the following
sequence of commands:
\begin{lstlisting}
%> cd $BOOST_ROOT
%> ./bootstrap.sh --prefix=$BOOST_ROOT
%> ./bjam --without-python
%> ./bjam --install
\end{lstlisting}
This will build Boost using the preferred method, and i
Finally, please be patient when compiling Boost from sources 
because it does take at least 30 minutes. 

\subsubsection{Windows}

Installing Boost from sources on Windows is not a trivial process. 
Moreover, the prebuilt version of Boost available for download from 
the main website does not contain the correct configuration or directory
layout. It is therefore recommended that you download and use the prebuilt 
version of Boost available for download from the CUTS website at the 
following location:
\url{http://www.dre.vanderbilt.edu/CUTS/downloads/thirdparty/boost}. Please download
the correct version of Boost that matches your version of Microsoft Visual
C++ and extract it to a common location on disk.

\section{Xerces-C}
\label{sec:thirdparty-xercesc}

Xerces-C 3.x is required when building and installing CUTS and other third-party
libraries. All artifacts for Xerces-C, such as prebuilt versions and source files, 
can be downloaded from the following location: \url{http://xerces.apache.org/xerces-c}. 

\subsection{System Configuration}

To build CUTS correctly, the Xerces-C environment variables must be defined. Please 
define the following required environment variables:
\begin{lstlisting}
%> export XERCESCROOT=/opt/thirdparty/xerces-c
%> export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$XERCESCROOT/lib
\end{lstlisting}
The configuration of Xerces-C is now complete. Once all the other
third-party libraries are installed you will be able to build CUTS
(see Chapter~\ref{chap:install}).

\subsection{Installation}

\subsubsection{Non-Windows}
 
If you are installing Xerces-C on a non-Windows system, \textit{e.g.}, Linux, 
Soloris, or MacOS X, then you can download the source code directly from its
main website (\url{http://xerces.apache.org/xerces-c}), build it, and install it using 
standard procedures.

\subsubsection{Windows}

Installing Xerces-C from sources on Windows is not a trivial process. 
Moreover, the prebuilt version of Xerces-C available for download from 
the main website does not contain the correct configuration or directory
layout. It is therefore recommended that you download and use the prebuilt 
version of Xerces-C available for download from the CUTS website at the 
following location:
\url{http://www.dre.vanderbilt.edu/CUTS/downloads/thirdparty/xerces-c}. Please download
the correct version of Xerces-C that matches your version of Microsoft Visual
C++ and extract it to a common location on disk.

\section{SQLite}
\label{sec:thirdparty-sqlite}

SQLite is required when building and installing several 
projects in CUTS. You can download the source code for SQLite
from the following location: \url{http://www.sqlite.org}

\subsection{System Configuration}

To build CUTS correctly, the SQLite environment variables must be defined. Please 
define the following required environment variables:
\begin{lstlisting}
%> export SQLITE_ROOT=/opt/thirdparty/SQLite
%> export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$SQLITE_ROOT/lib
%> export PATH=$PATH:$SQLITE_ROOT/bin
\end{lstlisting}
The configuration of SQLite is now complete. Once all the other
third-party libraries are installed you will be able to build CUTS
(see Chapter~\ref{chap:install}).

\subsection{Installation}

\subsubsection{Non-Windows}
 
If you are installing SQLite on a non-Windows system, \textit{e.g.}, Linux, 
Soloris, or MacOS X, then you can download the source code directly from its
main website (\url{http://www.sqlite.org}), build it, and install it using  
standard procedures.

\subsubsection{Windows}

Installing SQLite from sources on Windows is not a trivial process. 
It is therefore recommended that you download and use the prebuilt 
version of SQLite available for download from the CUTS website at the 
following location:
\url{http://www.dre.vanderbilt.edu/CUTS/downloads/thirdparty/sqlite}. Please download
the correct version of SQLite that matches your version of Microsoft Visual
C++ and extract it to a common location on disk.

\section{XML Schema Compiler (XSC)}
\label{sec:thirdparty-xsc}

XSC is required when building and installing CUTS. All artifacts
for XSC can be downloaded from the following location: 
\url{svn://svn.dre.vanderbilt.edu/XSC/trunk}. The remainder of this section
discusses how to build and install XSC.

\subsection{System Configuration}

You must configure you system installing XSC. Once you have downloaded 
XSC from the website above please define the following environment variables:
\begin{lstlisting}
%> svn co svn://svn.dre.vanderbilt.edu/XSC/trunk XSC
%> export XSC_ROOT=/opt/thirdparty/XSC
%> export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$XSC_ROOT/lib
%> export PATH=$PATH:$XSC_ROOT/bin
\end{lstlisting}

\subsection{Installation}

After you have configured your system for XSC, you are ready to build and 
install it. Please use the following steps to build and install XSC:
\begin{lstlisting}
%> cd $XSC_ROOT
%> $ACE_ROOT/bin/mwc.pl -type [build tool] -features xsc=1,xerces3=1 XSC.mwc
\end{lstlisting}
This will generate the workspace for building and installing XSC. The name of 
the workspace depends on the build tool specified when generating the 
workspace. Finally, using your build tool of choice, you can build and 
install XSC.

\section{Perl-Compatible Regular Expressions (PCRE)}
\label{sec:thirdparty-pcre}

PCRE is required when building and installing several projects in CUTS. 
You can download the source code for PCRE from the following 
location: \url{http://www.pcre.org}

\subsection{System Configuration}

To build CUTS correctly, the PCRE environment variables must be defined. Please 
define the following required environment variables:
\begin{lstlisting}
%> export PCRE_ROOT=/opt/thirdparty/pcre
%> export PCRE_VERSION= version of PCRE, blank if not applicable
%> export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$PCRE_ROOT/lib
\end{lstlisting}
The configuration of PCRE is now complete. Once all the other
third-party libraries are installed you will be able to build CUTS
(see Chapter~\ref{chap:install}).

\subsection{Installation}

\subsubsection{Non-Windows}
 
If you are installing PCRE on a non-Windows system, \textit{e.g.}, Linux, 
Soloris, or MacOS X, then you can download the source code directly from its
main website (\url{http://www.pcre.org}), build it, and install it using
standard procedures.

\subsubsection{Windows}

Installing PCRE from sources on Windows is not a trivial process. 
It is therefore recommended that you download and use the prebuilt 
version of PCRE available for download from the CUTS website at the 
following location:
\url{http://www.dre.vanderbilt.edu/CUTS/downloads/thirdparty/pcre}. Please download
the correct version of PCRE that matches your version of Microsoft Visual
C++ and extract it to a common location on disk.

\section{DOC Group Middleware}
\label{sec:thirdparty-acetaociao}

DOC Group Middleware is required when building and installing CUTS. Its
source code can be downloaded from the following location: 
\url{http://www.dre.vanderbilt.edu/CIAO}.

\subsection{System Configuration}

Unlike Boost, you must manually configure your system before installing
the DOC middleware. Once you have downloaded the tarball from the website 
above\footnote{It is recommended you download either the latest version
or snapshot of trunk from the SVN repo. Otherwise, you will not have access
to ADBC.}, please define the following 
environment variables:
\begin{lstlisting}
%> export ACE_ROOT=/opt/thirdparty/Middleware/ACE
%> export TAO_ROOT=/opt/thirdparty/Middleware/TAO
%> export CIAO_ROOT=/opt/thirdparty/Middleware/CIAO
%> export ADBC_ROOT=/opt/thirdparty/Middleware/ADBC
%> export DANCE_ROOT=/opt/thirdparty/Middleware/DAnCE

%> export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$ACE_ROOT/lib:$ADBC_ROOT/lib
%> export PATH=$PATH:$ACE_ROOT/bin:$CIAO_ROOT/bin:$DANCE_ROOT/bin
\end{lstlisting}

After defining the environment variables above, the next step is 
configuring the middleware for the target platform. This is accomplished by 
defining the \texttt{\$ACE\_ROOT/ace/config.h} header file, which will include the correct 
configuration for your platform. The included configuration file has the 
form \texttt{config-*}, where \texttt{*} is the platform of choice.
The following is an example \texttt{config.h} file for building DOC middleware 
on Linux platforms:
\begin{lstlisting}[language=C++]
// -*- C++ -*-

#ifndef _ACE_CONFIG_H_
#define _ACE_CONFIG_H_

#include ``config-linux.h''

#endif // !defined _ACE_CONFIG_H_
\end{lstlisting}

\subsubsection{Non-Windows}
Configuring the DOC middleware on non-Windows systems requires one more 
step. The configuration for the build engine also needs to be defined. 
Please use the following step to define the build engine's configuration:
\begin{lstlisting}
%> cd $ACE_ROOT/include/makeinclude
%> ln -s platform_*.GNU platform_macros.GNU
\end{lstlisting}
where \texttt{*} is the architecture for your platform of choice.

\subsection{Installation}

After you have configured your system, you are ready to build and 
install ACE and TAO. Please use the following steps to build and 
install the DOC middleware:
\begin{lstlisting}
%> cd $CIAO_ROOT
%> $ACE_ROOT/bin/mwc.pl -type [build tool] -features xerces3=1 CIAO_TAO_DAnCE.mwc
%> build the workspace
\end{lstlisting}

\subsection{ACE DataBase Connector (ADBC) Framework}
\label{sec:thirdparty-adbc}

The ACE DataBase Connector (ADBC) Framework is a set of C++ wrappers 
that provide a common interface for using different database drivers.
To install ADBC, first copy the file \texttt{default.features.tmpl} to
\texttt{default.features}. Open the new file and then enable/disable
the necessary features based on what wrappers you want to 
build.\footnote{It is assumed that you have installed the development
version for the database drivers that you plan to build.} Finally,
generate the workspace and build ADBC using the following commands:
\begin{lstlisting}
%> cd $ADBC_ROOT
%> $ACE_ROOT/bin/mwc.pl -type [build tool] ADBC.mwc
%> build the workspace
\end{lstlisting}
 
\section{RTI-DDS}
\label{sec:thirdparty-rtidds}

RTI-DDS is required if you are building CHAOS. You can obtain RTI-DDS
from the following location: \url{http://www.rti.com}

\subsection{System Configuration}
In order to use RTI-DDS with CUTS, the environment must be configured 
a certain way. Otherwise, there is great chance that CUTS emulation 
code that uses RTI-DDS will not compile correctly. Please define the 
following environment variables:
\begin{lstlisting}
%> export NDDSHOME=/opt/thirdparty/RTI-DDS
%> export NDDSARCHITECTURE= target arch (see \$NDDSHOME/lib)
%> export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$NDDSHOME/lib/$NDDSARCHITECTURE
\end{lstlisting}

\subsection{Installation}

RTI-DDS comes prebuilt. There are no installation procedures 
once you unzip the obtained tarball.

\section{OpenSplice DDS}
\label{sec:thirdparty-ospl}

OpenSplice DDS is required if you are building CHAOS. You can obtain 
OpenSplice DDS from the following location: \url{http://www.opensplice.org}.
Please make sure to download the binary version.

\subsection{System Configuration}

In order to use OpenSplice DDS with CUTS, the environment must be configured 
a certain way. Otherwise, there is great chance that CUTS emulation 
code that uses OpenSplice DDS will not compile correctly. Please define the 
following environment variables:
\begin{lstlisting}
%> export OSPL_TARGET=target arch
%> export OSPL_HOME=/opt/thirdparty/OpenSplice/$OSPL_TARGET
%> export OSPL_TEMP_PATH=$OPSL_HOME/etc/idlpp
%> export OSPL_URI="file://$OPSL_HOME/etc/config/ospl.xml"

%> export CLASSPATH=$OSPL_HOME/jar/dcpssaj.jar;$CLASSPATH
%> export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$OSPL_HOME/lib
\end{lstlisting}

\subsection{Installation}

OpenSplice DDS is built on top of The ACE ORB (TAO), which is also the
case for CUTS. In most cases, however, the version of TAO in either 
OpenSplice DDS and CUTS is not the same version. Likewise, OpenSplice DDS
and CUTS may not be built in such a way that they support different 
versions in the same process space, which is possible given the correct
configuration. Because of this, it is best to rebuild only the custom
library of OpenSplice DDS so that both OpenSplice DDS and CUTS can operate 
in the same address space. 

To rebuild the custom library in OpenSplice DDS, first determine
the version of TAO installed on your machine. The version number is
found in the following file: \texttt{\$TAO\_ROOT/VERSION}. Once you
have identified the version number, create the following directories
in OpenSplice DDS install directory:
\begin{lstlisting}
%> cp $OSPL_HOME/etc/idlpp/CCPP/[current version DDS_ACE_TAO] \\
  $OSPL_HOME/etc/idlpp/CCPP/DDS_ACE_TAO_x_y_z
%> cp $OSPL_HOME/include/dcps/C++/CCPP/[current version DDS_ACE_TAO] \\
  $OSPL_HOME/include/dcps/C++/CCPP/DDS_ACE_TAO_x_y_z
\end{lstlisting}
where \texttt{x\_y\_z} is the correct version of TAO installed on your 
machine. Please make sure to use underscores (\texttt{\_}) and not 
dots (\texttt{.}) in the version number. Finally, define the following 
environment variable so the OpenSplice DDS architecture knows what 
version of the ORB to use:
\begin{lstlisting}
%> export SPLICE_ORB=DDS_ACE_TAO_x_y_z
\end{lstlisting}
where \texttt{x\_y\_z} is the correct version of TAO installed on 
your machine as done above.

The final step in the process is rebuilding the custom library is
actually building it. This can be accomplished using the provide
MPC project file in CUTS and executing the following steps: 
\begin{lstlisting}
%> cd $CUTS_ROOT/contrib/OpenSplice
%> $ACE_ROOT/bin/mwc.pl -type [build type]
%> #build the generated solution
\end{lstlisting}

The build process will install the custom library in 
\texttt{\$OSPL\_HOME/lib}.

\subsubsection{Building Against TAO 1.7.8 (or Later)}

There were several changes to TAO 1.7.8 (or later) that break
building OpenSplice against the latest version of TAO. These
changes also have not been reflected in OpenSplice. To ensure
that the custom library in OpenSplice is able to build against
the TAO 1.7.8 (or later), please update 
\texttt{\$OSPL\_HOME/include/dcps/C++/CCPP/DDS\_ACE\_TAO\_x\_y\_z/orb\_abstraction.h}
with the following content:
\begin{lstlisting}[language=C++]
#include "tao/LocalObject.h"
#include "tao/Version.h"

namespace DDS
{
#if TAO_MAJOR_VERSION <= 1 && TAO_MINOR_VERSION <= 7 && TAO_BETA_VERSION < 8
  #define LOCAL_REFCOUNTED_OBJECT TAO_Local_RefCounted_Object
#else
  #define LOCAL_REFCOUNTED_OBJECT ::CORBA::LocalObject
#endif
  #define LOCAL_REFCOUNTED_VALUEBASE ::CORBA::DefaultValueRefCountBase

#if TAO_MAJOR_VERSION <= 1 && TAO_MINOR_VERSION <= 7 && TAO_BETA_VERSION < 8
  #define THROW_ORB_EXCEPTIONS  ACE_THROW_SPEC ((CORBA::SystemException))
  #define THROW_ORB_AND_USER_EXCEPTIONS(...) \
    ACE_THROW_SPEC ((CORBA::SystemException, __VA_ARGS__))
#else
  #define THROW_ORB_EXCEPTIONS
  #define THROW_ORB_AND_USER_EXCEPTIONS(...)
#endif

  // These definitions seem to be OK.
  #define THROW_VALUETYPE_ORB_EXCEPTIONS
  #define THROW_VALUETYPE_ORB_AND_USER_EXCEPTIONS(...)
}
\end{lstlisting}
You should now be able to build the custom library against 
TAO 1.7.8 (or later) without any build errors.
